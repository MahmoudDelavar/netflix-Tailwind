import Head from 'next/head';
import { getSession, useSession } from 'next-auth/react';
import Login from '../components/auth/login';

import {
  getActionMovie,
  getComedyMovie,
  getDocumentariesMovie,
  getHorrorMovie,
  getMoviePosters,
  getRomanceMovie,
  getTopRate,
  getTrendig,
} from '../utils/requests/fetchers';
import Hero from '../components/hero';
import MovieCollection from '../components/movie-collection';

//=====================================================
export default function Home({
  posters,
  trends,
  actionMovies,
  topRate,
  comedyMovie,
  horrorMovies,
  fomanceMovie,
  documentariesMovie,
}) {
  const { data: session } = useSession();

  // if (!session) return <Login />;

  return (
    <>
      <Head>
        <title>clone-netflix</title>
        <meta name='description' content='Generated by create next app' />
        <link rel='icon' href='/logo.png' />
      </Head>

      <main className='relative bg-gradient-to-b from-gray-900/10 to-[#010511] space-x-3'>
        <Hero moviePosters={posters} />
        <MovieCollection title={'action'} />
      </main>
    </>
  );
}

export async function getServerSideProps(context) {
  const session = await getSession(context);
  const posters = await getMoviePosters();
  const trends = await getTrendig();
  const topRate = await getTopRate();
  const actionMovies = await getActionMovie();
  const comedyMovie = await getComedyMovie();
  const horrorMovies = await getHorrorMovie();
  const fomanceMovie = await getRomanceMovie();
  const documentariesMovie = await getDocumentariesMovie();

  return {
    props: {
      session,
      posters,
      trends,
      actionMovies,
      topRate,
      comedyMovie,
      horrorMovies,
      fomanceMovie,
      documentariesMovie,
    },
  };
}
